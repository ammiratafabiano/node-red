module.exports = function(RED) {
    function httpListener(config) {

        RED.nodes.createNode(this,config);
     	this.key = config.key;
        var node = this;
        
        const https = require('https');
        var fs = require('fs');

		var exec = require('child_process').exec;
		var child;
		
		node.on('input', function(msg) {
		
			if (msg.payload == 1) {
		
				child = exec("twurl /1.1/search/tweets.json?q="+node.key, function (error, stdout, stderr) {
				  if (error !== null) {
					console.log('exec error: ' + error);
				  }
				  msg.payload = JSON.parse(stdout);
				  msg.topic = "/twitterAPI";
				  node.send(msg);
				});			
			}
			
		});
		
		node.on('close', function() {
		});
    }
    RED.nodes.registerType("twitterService",httpListener);
}