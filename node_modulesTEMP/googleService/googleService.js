module.exports = function(RED) {
    function googleAPI(config) {

        RED.nodes.createNode(this,config);
     	this.key = config.key;
        var node = this;
        
        const https = require('https');
        
        node.on('input', function(msg) {
        
        	if (msg.payload == 1) {

				https.get('https://www.googleapis.com/customsearch/v1?key=AIzaSyDctwEim9z8Fdzawj5FPt_CbulgsmnUt1Y&cx=007493646929766769204:g-5f-fyln1k&q='+node.key, (res) => {
				
					let data = '';
					//console.log('statusCode:', res.statusCode);
					//console.log('headers:', res.headers);

					res.on('data', (chunk) => {
						data += chunk;
					});

					res.on('end', () => {
						msg.payload = JSON.parse(data).items;
						msg.topic = "/googleAPI";
						node.send(msg);
					});

				}).on('error', (e) => {
				  	console.error(e);
				});
			}
		});
		node.on('close', function() {
		});
    }
    RED.nodes.registerType("googleService",googleAPI);
}