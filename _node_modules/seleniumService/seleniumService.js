module.exports = function(RED) {
    function httpListener(config) {

        RED.nodes.createNode(this,config);
     	this.key = config.key;
        var node = this;
        
        const https = require('https');
        
		const assert = require('assert');

		const {Builder, By, Key, until} = require('selenium-webdriver');
		
		node.on('input', function(msg) {
		
			if (msg.payload == 1) {

				var out = "selenium test";

				async function selenium() {
					//let driver = await new Builder().forBrowser('firefox').build();

					try {
						//await driver.get('http://www.google.it');
						//await driver.findElement(By.name('q')).sendKeys(node.key, Key.RETURN);
						//await driver.sleep(5000);
						//out = JSON.stringify(driver.findElements(By.css(".bkWMgd .st")));
					}
					finally {
						//await driver.quit();
						msg.payload = out;
						msg.topic = "/seleniumAPI";
						node.send(msg);
					}
				}
				selenium();
			  	
			}
  				
		});
		
		node.on('close', function() {
		});
    }
    RED.nodes.registerType("seleniumService",httpListener);
}